<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <title>Aguardando pagamento...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{
      --bg:#0b1020;
      --card:#11162a;
      --muted:#c1c7d3;
      --text:#f4f6fb;
      --brand:#4f7cff;
      --brand-2:#39b885;
      --shadow:0 12px 40px rgba(0,0,0,.35);
      --ring:0 0 0 4px rgba(79,124,255,.15);
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f3f5f9; --card:#ffffff; --text:#0e1320; --muted:#5b6473; --shadow:0 12px 30px rgba(10,36,99,.12) }
    }
    *{ box-sizing:border-box }
    body{
      margin:0; background:radial-gradient(1200px 1200px at 10% -10%, rgba(79,124,255,.16), transparent 40%),
                 radial-gradient(1200px 1200px at 110% 10%, rgba(57,184,133,.14), transparent 40%),
                 var(--bg);
      font: 16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;
      color:var(--text);
      min-height:100dvh; display:grid; place-items:center; padding:28px 18px;
    }
    .card{
      width:min(720px, 96vw);
      background:var(--card);
      box-shadow:var(--shadow);
      border-radius:20px; padding:26px 22px 22px;
      position:relative; overflow:hidden;
      outline:1px solid rgba(255,255,255,.06);
    }
    .card::before{
      content:""; position:absolute; inset:auto -30% -25% -30%;
      height:220px; filter:blur(50px); opacity:.25;
      background:conic-gradient(from 90deg at 50% 50%, #4f7cff, #39b885, #4f7cff);
    }
    .head{
      display:flex; align-items:center; gap:14px; margin-bottom:6px;
    }
    .pulse{
      width:12px; height:12px; border-radius:50%;
      background:var(--brand-2);
      box-shadow:0 0 0 0 rgba(57,184,133,.55);
      animation:pulse 1.6s infinite;
    }
    @keyframes pulse { to { box-shadow:0 0 0 12px rgba(57,184,133,0) } }

    h1{ margin:0; font-size:clamp(20px, 2.1vw, 24px); letter-spacing:.2px }
    p{ margin:10px 0 0; color:var(--muted) }

    .actions{ margin-top:18px; display:flex; flex-wrap:wrap; gap:10px }
    .btn{
      appearance:none; border:0; cursor:pointer; text-decoration:none;
      display:inline-flex; align-items:center; gap:10px;
      padding:12px 16px; border-radius:12px; font-weight:700;
      color:#fff; background:linear-gradient(135deg, var(--brand), #3f5eea);
      transition:transform .12s ease, box-shadow .12s ease;
      box-shadow:0 10px 24px rgba(79,124,255,.28);
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 14px 28px rgba(79,124,255,.34) }
    .btn.alt{ background:linear-gradient(135deg, #2f384a, #202535); color:#e7ebf6; box-shadow:none }
    .hint{ margin-top:8px; color:var(--muted); font-size:.95rem }

    .divider{
      margin:18px 0; height:1px; width:100%;
      background:linear-gradient(90deg, transparent, rgba(255,255,255,.10), transparent);
    }

    .status{
      display:flex; gap:14px; flex-wrap:wrap;
      padding:12px; border-radius:14px; background:rgba(255,255,255,.04);
      outline:1px solid rgba(255,255,255,.06);
    }
    .badge{
      padding:6px 10px; border-radius:999px; font-size:.85rem; font-weight:700;
      background:rgba(79,124,255,.12); color:#dfe6ff; letter-spacing:.2px;
    }
    .badge.neutral{ background:rgba(255,255,255,.06); color:#d7dbe6 }

    .footer{
      margin-top:14px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      color:var(--muted); font-size:.9rem;
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace }
  </style>
</head>
<body>
  <div class="card" role="status" aria-live="polite">
    <div class="head">
      <span class="pulse" aria-hidden="true"></span>
      <h1>Quase l√°! Estamos aguardando a confirma√ß√£o do pagamento</h1>
    </div>
    <p>O checkout do Mercado Pago foi aberto em uma nova aba. Conclua o pagamento por l√° e n√≥s atualizaremos aqui automaticamente.</p>

    <div class="actions">
      <a class="btn" href="{{ init_point }}" target="_blank" rel="noopener">üîÅ Abrir checkout novamente</a>
      <a class="btn alt" href="{% url 'inscricoes:ver_inscricao' inscricao.id %}">‚Ü©Ô∏è Voltar para minha inscri√ß√£o</a>
    </div>
    <p class="hint">Voc√™ n√£o precisa atualizar esta p√°gina manualmente.</p>

    <div class="divider" aria-hidden="true"></div>

    <div class="status">
      <span class="badge">Inscri√ß√£o #{{ inscricao.id }}</span>
      <span class="badge neutral mono">R$ {{ inscricao.evento.valor_inscricao|floatformat:2 }}</span>
      <span class="badge neutral">Evento: {{ inscricao.evento.nome }}</span>
    </div>

    <div class="footer">
      <span>Seguran√ßa por Mercado Pago</span>
      <span class="mono">Aguardando‚Ä¶</span>
    </div>
  </div>

  <script>
    // Tenta abrir a aba (alguns navegadores podem bloquear popups)
    try { window.open("{{ init_point }}", "_blank"); } catch(e) {}

    const inscricaoId = "{{ inscricao.id }}";

    async function checar() {
      try {
        const r = await fetch(`/api/pagamento/status/${inscricaoId}/`, { cache: "no-store" });
        if (!r.ok) throw new Error();
        const j = await r.json();
        if (j.status === "confirmado") {
          window.location.href = `/pagamento/sucesso/{{ inscricao.id }}/`;
          return;
        }
        if (j.status === "cancelado") {
          window.location.href = `/pagamento/falha/{{ inscricao.id }}/`;
          return;
        }
      } catch(e) {}
      setTimeout(checar, 5000);
    }
    setTimeout(checar, 5000);
  </script>
</body>
</html>
