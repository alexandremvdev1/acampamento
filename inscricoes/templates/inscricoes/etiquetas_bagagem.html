{% load cloudinary %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Etiquetas de Bagagem ‚Äì {{ evento.nome }}</title>
  <style>
    /* Reset e fontes */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: "Helvetica Neue", Arial, sans-serif; background:#f9f9f9; color:#333; }

    /* Bot√£o Imprimir */
    .print-btn {
      position: fixed; top:16px; right:16px;
      padding:10px 14px; background:#007bff; color:#fff;
      border:none; border-radius:4px; cursor:pointer;
      font-size:0.9rem; box-shadow:0 2px 6px rgba(0,0,0,0.2);
      transition:background .2s; z-index:1000;
    }
    .print-btn:hover { background:#0056b3; }
    @media print { .print-btn { display:none } }

    /* Filtro de cidades */
    .filter-form {
      background:#fff; border-bottom:1px solid #ddd;
      padding:12px 16px; display:flex; align-items:center; gap:8px;
    }
    .filter-form label { font-weight:600 }
    .filter-form select {
      padding:6px; border:1px solid #ccc; border-radius:4px;
    }

    /* P√°gina A4 paisagem */
    .page {
      width:297mm; height:210mm; margin:auto;
      padding:12mm; background:#fff; page-break-after:always;
    }
    /* Grid 2 colunas √ó 5 linhas */
    .grid {
      display:grid;
      grid-template-columns:repeat(2,1fr);
      grid-template-rows:repeat(5,1fr);
      gap:12px;
      height:100%;
    }

    /* Etiqueta */
    .label {
      position:relative;
      padding:8px;
      background:#fafafa;
      border:1px solid #ccc;
      border-radius:6px;
      box-shadow:0 1px 3px rgba(0,0,0,0.1);
      text-align:center;
      page-break-inside:avoid;
    }
    .label .numero {
      position:absolute; top:6px; right:6px;
      background:#007bff; color:#fff;
      padding:2px 6px; border-radius:3px;
      font-size:0.75rem; font-weight:600;
    }

    .evento { font-size:0.85rem; font-weight:700; color:#222 }
    .paroquia { font-size:0.80rem; color:#555; margin-bottom:6px }

    .label img,
    .label .placeholder {
      display:block; width:60px; height:60px;
      border-radius:50%; object-fit:cover;
      margin:6px auto;
      background:#e0e0e0;
    }

    .nome { font-size:1rem; font-weight:600; color:#111; margin:6px 0 2px }
    .cidade { font-size:0.85rem; color:#666 }

    /* QR Code no canto inferior esquerdo */
    .label .qr {
      position:absolute; bottom:6px; left:6px;
      width:48px; height:48px;
      border:1px solid #ccc; border-radius:4px;
      background:#fff;
    }
  </style>
</head>
<body>

  <button class="print-btn" onclick="window.print()">üñ®Ô∏è Imprimir</button>

  <form method="get" class="filter-form">
    <label for="cidade">Filtrar por cidade:</label>
    <select id="cidade" name="cidade" onchange="this.form.submit()">
      <option value="">Todas</option>
      {% for c in cidades %}
        <option value="{{ c }}" {% if c == cidade_sel %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
  </form>

  {% for label in labels %}
    {% if forloop.first or forloop.counter0|divisibleby:"10" %}
      <div class="page"><div class="grid">
    {% endif %}

      <div class="label">
        <span class="numero">Bagagem {% cycle '1' '2' '3' %}</span>
        <p class="evento">{{ evento.nome }}</p>
        <p class="paroquia">{{ evento.paroquia.nome }}</p>

        {% if label.participante.foto %}
          {% cloudinary label.participante.foto width=60 height=60 crop="thumb" %}
        {% else %}
          <div class="placeholder"></div>
        {% endif %}

        <p class="nome">{{ label.participante.nome }}</p>
        <p class="cidade">{{ label.participante.cidade }}</p>

        {# QR Code apontando para a URL da inscri√ß√£o #}
        <img
          class="qr"
          src="https://api.qrserver.com/v1/create-qr-code/?size=48x48&data={{ label.inscricao_url|urlencode }}"
          alt="QR {{ label.participante.nome }}"
        >
      </div>

    {% if forloop.counter|divisibleby:"10" or forloop.last %}
        </div></div>
    {% endif %}
  {% endfor %}

</body>
</html>
