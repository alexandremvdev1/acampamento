{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Todas as Fichas – {{ evento.nome|default:"não informado" }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  /* Forçar 1 ficha por página A4 */
  @page { size: A4 portrait; margin: 6mm; }
  :root{--ink:#111827;--muted:#6b7280;--line:#e5e7eb;--bg:#ffffff}
  *{box-sizing:border-box}
  html,body{margin:0}
  body{background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--ink);font-size:12px;line-height:1.2}

  .sheet{max-width:210mm;margin:0 auto;padding:6mm;position:relative;page-break-after: always;}
  .top{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px;border-bottom:1px solid var(--line);padding-bottom:4px}
  .t-left{min-width:0}
  .t-title{font-weight:700;margin:0;font-size:14px;line-height:1}
  .t-sub{margin:3px 0 0 0;color:var(--muted);font-size:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:120mm}
  .media{display:flex;align-items:center;gap:6px}
  .photo{width:58px;height:58px;border-radius:50%;object-fit:cover;border:1px solid var(--line);background:#f3f4f6}
  .qr{width:72px;height:72px;border:1px dashed var(--line);border-radius:4px;padding:2px;background:#fff}

  .grid{display:grid;grid-template-columns:repeat(18,1fr);grid-auto-flow:dense;gap:4px}
  .sec{margin-bottom:6px}
  .sec h3{margin:0 0 4px 0;font-size:11px;color:#111}
  .f{display:flex;flex-direction:column;min-width:0}
  .f label{font-size:9px;color:var(--muted);margin-bottom:1px;line-height:1}
  .v{border:1px solid var(--line);border-radius:4px;padding:4px 6px;min-height:22px;display:flex;align-items:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;background:#fff}
  .v-wrap{white-space:normal;word-break:break-word}

  .span-18{grid-column:span 18}.span-16{grid-column:span 16}.span-12{grid-column:span 12}
  .span-10{grid-column:span 10}.span-9{grid-column:span 9}
  .span-8{grid-column:span 8}.span-7{grid-column:span 7}
  .span-6{grid-column:span 6}.span-5{grid-column:span 5}
  .span-4{grid-column:span 4}.span-3{grid-column:span 3}
  .span-2{grid-column:span 2}.span-1{grid-column:span 1}

  .footer{margin-top:6px;text-align:center;font-size:9px;color:var(--muted)}
  .footer img{display:block;margin:0 auto 4px auto;max-height:16px}

  .btn-print{background:#2563eb;color:#fff;border:none;padding:6px 10px;font-size:11px;border-radius:4px;cursor:pointer}
  .toolbar{display:flex;justify-content:center;gap:8px;padding:8px}

  @media print{
    body{font-size:10px}
    .t-title{font-size:12px}
    .t-sub{font-size:9px;max-width:140mm}
    .photo{width:50px;height:50px}
    .qr{width:64px;height:64px}
    .toolbar{display:none!important}
  }
</style>
</head>
<body>

<!-- Barra para impressão (oculta no print) -->
<div class="toolbar">
  <button class="btn-print" onclick="window.print()">Imprimir</button>
</div>

{% for inscricao in inscricoes %}
{% with base=inscricao.inscricaosenior|default:inscricao.inscricaojuvenil|default:inscricao.inscricaomirim|default:inscricao.inscricaoservos %}
<div class="sheet">
  <!-- Cabeçalho -->
  <div class="top">
    <div class="t-left">
      <h1 class="t-title">FICHA DE INSCRIÇÃO</h1>
      <div class="t-sub">{{ inscricao.evento.nome|default:"não informado" }}</div>
    </div>
    <div class="media">
      {% if inscricao.participante.foto %}
        <img class="photo" src="{{ inscricao.participante.foto.url }}" alt="Foto do participante">
      {% else %}
        <div class="photo" style="display:grid;place-items:center;font-size:9px;color:#9ca3af">sem foto</div>
      {% endif %}
      <img class="qr" src="{% url 'inscricoes:qr_code_png' inscricao.participante.qr_token %}" alt="QR participante">
    </div>
  </div>

  <!-- Participante -->
  <div class="sec">
    <h3>Participante</h3>
    <div class="grid">
      <div class="f span-12"><label>Nome</label><div class="v">{{ inscricao.participante.nome|default:"não informado" }}</div></div>
      <div class="f span-3"><label>Nasc.</label><div class="v">{{ base.data_nascimento|date:"d/m/Y"|default:"não informado" }}</div></div>
      <div class="f span-3"><label>CPF</label><div class="v">{{ inscricao.participante.cpf|default:"não informado" }}</div></div>

      <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.participante.telefone|default:"não informado" }}</div></div>
      <div class="f span-8"><label>E-mail</label><div class="v">{{ inscricao.participante.email|default:"não informado" }}</div></div>
      <div class="f span-3"><label>CEP</label><div class="v">{{ inscricao.participante.CEP|default:"não informado" }}</div></div>
      <div class="f span-3"><label>Nº</label><div class="v">{{ inscricao.participante.numero|default:"não informado" }}</div></div>

      <div class="f span-8"><label>Endereço</label><div class="v">{{ inscricao.participante.endereco|default:"não informado" }}</div></div>
      <div class="f span-4"><label>Bairro</label><div class="v">{{ inscricao.participante.bairro|default:"não informado" }}</div></div>
      <div class="f span-6"><label>Cidade</label><div class="v">{{ inscricao.participante.cidade|default:"não informado" }}</div></div>
      <div class="f span-2"><label>UF</label><div class="v">{{ inscricao.participante.estado|default:"não informado" }}</div></div>
    </div>
  </div>

  <!-- Dados adicionais -->
  <div class="sec">
    <h3>Dados adicionais</h3>
    <div class="grid">
      <div class="f span-2"><label>Altura</label><div class="v">{{ base.altura|default:"não informado" }}</div></div>
      <div class="f span-2"><label>Peso</label><div class="v">{{ base.peso|default:"não informado" }}</div></div>
      <div class="f span-2"><label>Batizado?</label><div class="v">{{ base.get_batizado_display|default:"não informado" }}</div></div>
      <div class="f span-4"><label>Estado civil</label><div class="v">{{ base.get_estado_civil_display|default:"não informado" }}</div></div>
      <div class="f span-4"><label>Casado na Igreja?</label><div class="v">{{ base.get_casado_na_igreja_display|default:"não informado" }}</div></div>

      <div class="f span-6"><label>Paróquia</label><div class="v">{{ base.paroquia|default:"não informado" }}</div></div>
      <div class="f span-6"><label>Pastoral/Movimento</label><div class="v">{{ base.pastoral_movimento|default:"não informado" }}</div></div>
      <div class="f span-6"><label>Outra Pastoral/Movimento</label><div class="v">{{ base.outra_pastoral_movimento|default:"não informado" }}</div></div>

      <div class="f span-2"><label>Dizimista?</label><div class="v">{{ base.get_dizimista_display|default:"não informado" }}</div></div>
      <div class="f span-2"><label>Crismado?</label><div class="v">{{ base.get_crismado_display|default:"não informado" }}</div></div>
      <div class="f span-2"><label>Camisa</label><div class="v">{{ base.tamanho_camisa|default:"não informado" }}</div></div>

      <div class="f span-12"><label>Indicado por</label><div class="v">{{ base.indicado_por|default:"não informado" }}</div></div>
    </div>
  </div>

  <!-- Saúde (inclui Pressão/Diabetes aqui) -->
  <div class="sec">
    <h3>Saúde</h3>
    <div class="grid">
      <div class="f span-3"><label>Pressão alta?</label><div class="v">{{ base.get_pressao_alta_display|default:"não informado" }}</div></div>
      <div class="f span-3"><label>Diabetes?</label><div class="v">{{ base.get_diabetes_display|default:"não informado" }}</div></div>

      <div class="f span-2"><label>Prob. Saúde?</label><div class="v">{{ base.get_problema_saude_display|default:"não informado" }}</div></div>
      <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ base.qual_problema_saude|default:"não informado" }}</div></div>
      <div class="f span-2"><label>Med. Ctrl.?</label><div class="v">{{ base.get_medicamento_controlado_display|default:"não informado" }}</div></div>
      <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ base.qual_medicamento_controlado|default:"não informado" }}</div></div>

      <div class="f span-4"><label>Protocolo</label><div class="v v-wrap">{{ base.protocolo_administracao|default:"não informado" }}</div></div>
      <div class="f span-2"><label>Mob. Red.?</label><div class="v">{{ base.get_mobilidade_reduzida_display|default:"não informado" }}</div></div>
      <div class="f span-6"><label>Qual?</label><div class="v v-wrap">{{ base.qual_mobilidade_reduzida|default:"não informado" }}</div></div>
      <div class="f span-2"><label>Tipo Sang.</label><div class="v">{{ base.tipo_sanguineo|default:"não informado" }}</div></div>
      <div class="f span-4"><label><!-- espaço --></label><div class="v" style="border:none;background:transparent;min-height:0;padding:0"></div></div>

      <div class="f span-2"><label>Alerg. Alim.?</label><div class="v">{{ base.get_alergia_alimento_display|default:"não informado" }}</div></div>
      <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ base.qual_alergia_alimento|default:"não informado" }}</div></div>
      <div class="f span-2"><label>Alerg. Med.?</label><div class="v">{{ base.get_alergia_medicamento_display|default:"não informado" }}</div></div>
      <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ base.qual_alergia_medicamento|default:"não informado" }}</div></div>

      <div class="f span-18"><label>Informações extras</label><div class="v v-wrap">{{ base.informacoes_extras|default:"não informado" }}</div></div>
    </div>
  </div>

  <!-- Cônjuge -->
  {% if inscricao.conjuge or base.nome_conjuge %}
  <div class="sec">
    <h3>Cônjuge</h3>
    <div class="grid">
      {% if inscricao.conjuge %}
        <div class="f span-10"><label>Nome</label><div class="v">{{ inscricao.conjuge.nome|default:"não informado" }}</div></div>
        <div class="f span-4"><label>Inscrito?</label><div class="v">{{ inscricao.conjuge.get_conjuge_inscrito_display|default:"não informado" }}</div></div>
        <div class="f span-4"><label>Já é campista?</label><div class="v">{{ inscricao.conjuge.get_ja_e_campista_display|default:"não informado" }}</div></div>
      {% else %}
        <div class="f span-10"><label>Nome</label><div class="v">{{ base.nome_conjuge|default:"não informado" }}</div></div>
        <div class="f span-4"><label>Inscrito?</label><div class="v">{{ base.get_conjuge_inscrito_display|default:"não informado" }}</div></div>
        <div class="f span-4"><label><!-- vazio --></label><div class="v" style="border:none;background:transparent;min-height:0;padding:0"></div></div>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Paróquia (da inscrição) -->
  <div class="sec">
    <h3>Paróquia (Inscrição)</h3>
    <div class="grid">
      <div class="f span-10"><label>Paróquia</label><div class="v">{{ inscricao.paroquia.nome|default:"não informado" }}</div></div>
      <div class="f span-6"><label>Cidade</label><div class="v">{{ inscricao.paroquia.cidade|default:"não informado" }}</div></div>
      <div class="f span-2"><label>UF</label><div class="v">{{ inscricao.paroquia.estado|default:"não informado" }}</div></div>
    </div>
  </div>

  <!-- Responsáveis -->
  <div class="sec">
    <h3>Responsáveis</h3>
    <div class="grid">
      <div class="f span-10"><label>Resp. 1 — Nome</label><div class="v">{{ inscricao.responsavel_1_nome|default:"não informado" }}</div></div>
      <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.responsavel_1_telefone|default:"não informado" }}</div></div>
      <div class="f span-3"><label>Grau</label><div class="v">{{ inscricao.responsavel_1_grau_parentesco|default:"não informado" }}</div></div>
      <div class="f span-1"><label>Camp.</label><div class="v">{% if inscricao.responsavel_1_ja_e_campista %}Sim{% else %}Não{% endif %}</div></div>

      <div class="f span-10"><label>Resp. 2 — Nome</label><div class="v">{{ inscricao.responsavel_2_nome|default:"não informado" }}</div></div>
      <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.responsavel_2_telefone|default:"não informado" }}</div></div>
      <div class="f span-3"><label>Grau</label><div class="v">{{ inscricao.responsavel_2_grau_parentesco|default:"não informado" }}</div></div>
      <div class="f span-1"><label>Camp.</label><div class="v">{% if inscricao.responsavel_2_ja_e_campista %}Sim{% else %}Não{% endif %}</div></div>
    </div>
  </div>

  <!-- Emergência -->
  <div class="sec">
    <h3>Contato de emergência</h3>
    <div class="grid">
      <div class="f span-10"><label>Nome</label><div class="v">{{ inscricao.contato_emergencia_nome|default:"não informado" }}</div></div>
      <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.contato_emergencia_telefone|default:"não informado" }}</div></div>
      <div class="f span-3"><label>Grau</label><div class="v">{{ inscricao.contato_emergencia_grau_parentesco|default:"não informado" }}</div></div>
      <div class="f span-1"><label>Camp.</label><div class="v">{% if inscricao.contato_emergencia_ja_e_campista %}Sim{% else %}Não{% endif %}</div></div>
    </div>
  </div>

  <!-- Rodapé -->
  <div class="footer">
    <img src="{% static 'img/logo.png' %}" alt="Logo do sistema">
    Desenvolvido por Alexandre Martins Vieira
  </div>
</div>
{% endwith %}
{% empty %}
<p style="text-align:center; padding:20px;">Nenhuma ficha para imprimir.</p>
{% endfor %}

</body>
</html>
