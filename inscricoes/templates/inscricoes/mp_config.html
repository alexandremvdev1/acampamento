<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>üí≥ Configura√ß√£o Mercado Pago</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --primary:#3498db;
      --secondary:#2c3e50;
      --bg:#f4f7f9;
      --card:#ffffff;
      --text:#333;
      --muted:#6b7280;
      --line:#e5e7eb;
      --ok-bg:#d1e7dd; --ok-border:#badbcc; --ok-text:#0f5132;
      --err-bg:#f8d7da; --err-border:#f5c2c7; --err-text:#842029;
      --info-bg:#eef6ff; --info-border:#cfe3ff; --info-text:#1e40af;
      --success:#16a34a;
    }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{
      font-family:'Roboto', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background:var(--bg); color:var(--text);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .wrap{ width:100%; max-width:560px }
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:14px;
      box-shadow:0 10px 28px rgba(0,0,0,.06); padding:22px;
    }
    .header{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px }
    .title{ margin:0; font-weight:700; font-size:20px; color:var(--secondary); display:flex; align-items:center; gap:8px }
    .back-link{
      appearance:none; border:1px solid var(--line); background:#fff; color:#111827;
      padding:8px 12px; border-radius:10px; font-weight:600; text-decoration:none; font-size:14px;
    }
    .alert{
      border:1px solid var(--info-border); background:var(--info-bg); color:var(--info-text);
      border-radius:12px; padding:14px; margin:10px 0 16px; text-align:center;
    }
    .row-actions{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:10px }

    /* Mensagens (Django) */
    .messages{ list-style:none; margin:0 0 12px; padding:0 }
    .msg{ border-radius:10px; padding:12px 14px; border:1px solid transparent; font-weight:500; margin-bottom:10px }
    .success{ background:var(--ok-bg); border-color:var(--ok-border); color:var(--ok-text) }
    .error{ background:var(--err-bg); border-color:var(--err-border); color:var(--err-text) }

    /* Form */
    form{ display:grid; gap:14px; margin-top:8px }
    label{ font-weight:500; color:var(--secondary); }
    .field{
      position:relative; display:flex; align-items:center; gap:8px;
      background:#f9fafb; border:1px solid var(--line); border-radius:10px; padding:8px 8px 8px 12px;
      transition:border-color .2s, box-shadow .2s, background .2s;
    }
    .field:focus-within{ border-color:var(--primary); box-shadow:0 0 0 3px rgba(52,152,219,.15); background:#fff }
    input[type="text"], input[type="password"]{
      flex:1; border:0; background:transparent; font-size:15px; color:var(--text); outline:0;
      min-width:0;
    }
    .hint{ font-size:12px; color:var(--muted); margin-top:-6px }
    .invalid{ border-color:var(--err-border) !important; background:#fff5f5 }
    .errorlist{ margin:6px 0 0; padding-left:18px; color:var(--err-text); font-size:13px }

    /* Bot√µes utilit√°rios no input */
    .btn-ghost{
      appearance:none; border:1px solid var(--line); background:#fff; color:#111827;
      padding:8px 10px; border-radius:8px; font-weight:600; cursor:pointer; font-size:13px;
    }
    .btn-ghost:hover{ filter:brightness(.98) }
    .eye{ border:none; background:transparent; cursor:pointer; font-size:18px; color:#7b8694; padding:4px 6px; border-radius:8px }
    .eye:hover{ background:#eef2f7 }

    /* Switch */
    .switch{ display:flex; align-items:center; gap:10px; }
    .switch input{ position:absolute; opacity:0; }
    .toggle{
      width:44px; height:26px; background:#e5e7eb; border-radius:999px; position:relative; transition:background .2s;
    }
    .toggle::after{
      content:""; width:20px; height:20px; background:#fff; border-radius:50%;
      position:absolute; top:3px; left:3px; box-shadow:0 1px 3px rgba(0,0,0,.2); transition:left .2s;
    }
    .switch input:checked + .toggle{ background:#86efac }
    .switch input:checked + .toggle::after{ left:21px }

    /* Submit */
    .btn{
      appearance:none; border:0; border-radius:10px; padding:12px 16px; font-weight:700;
      cursor:pointer; font-size:16px; background:var(--primary); color:#fff;
      box-shadow:0 6px 16px rgba(52,152,219,.25); transition:filter .2s, transform .03s ease-in;
      width:100%;
    }
    .btn:hover{ filter:brightness(.97) }
    .btn:active{ transform:translateY(1px) }
    .btn[disabled]{ opacity:.7; cursor:not-allowed }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <h1 class="title">üí≥ Configura√ß√£o Mercado Pago</h1>
        <a class="back-link" href="{% url 'inscricoes:admin_paroquia_painel' %}">‚Üê Painel</a>
      </div>

      {% if politica %}
        {% if politica.email_contato or politica.telefone_contato %}
          <div class="alert" role="status" aria-live="polite">
            <div style="font-weight:700; margin-bottom:6px;">D√∫vidas na configura√ß√£o?</div>
            <div>Entre em contato com o suporte da sua par√≥quia.</div>
            <div class="row-actions">
              {% if politica.email_contato %}
                <a class="btn-ghost"
                   href="mailto:{{ politica.email_contato }}?subject=Ajuda%20na%20configura%C3%A7%C3%A3o%20do%20Mercado%20Pago">‚úâÔ∏è E-mail</a>
              {% endif %}
              {% if politica.telefone_contato %}
                <a class="btn-ghost"
                   href="https://wa.me/{{ politica.telefone_contato|cut:'+' }}"
                   target="_blank" rel="noopener">üü¢ WhatsApp</a>
              {% endif %}
            </div>
          </div>
        {% else %}
          <div class="alert">D√∫vidas na configura√ß√£o? Entre em contato com o suporte da sua par√≥quia.</div>
        {% endif %}
      {% else %}
        <div class="alert">D√∫vidas na configura√ß√£o? Entre em contato com o suporte da sua par√≥quia.</div>
      {% endif %}

      {% if messages %}
        <ul class="messages">
          {% for message in messages %}
            <li class="msg {% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      <form method="post" novalidate>
        {% csrf_token %}
        {% if form.non_field_errors %}
          <div class="msg error">{{ form.non_field_errors }}</div>
        {% endif %}

        <!-- ACCESS TOKEN -->
        <label for="id_access_token">Access Token</label>
        <div class="field {% if form.access_token.errors %}invalid{% endif %}">
          <input
            id="id_access_token"
            type="password"
            name="access_token"
            value="{{ form.access_token.value|default_if_none:'' }}"
            placeholder="TEST-xxxxxxxxxxxxxxxxxxxx-xxxxxxxxxxxxx"
            required
            autocomplete="off"
          />
          <button class="eye" type="button" data-eye="id_access_token" aria-label="Mostrar/ocultar token">üëÅÔ∏è</button>
          <button class="btn-ghost" type="button" data-copy="id_access_token">Copiar</button>
        </div>
        {% if form.access_token.errors %}
          <ul class="errorlist">
            {% for error in form.access_token.errors %}<li>{{ error }}</li>{% endfor %}
          </ul>
        {% else %}
          <div class="hint">Cole o Access Token gerado no painel do Mercado Pago.</div>
        {% endif %}

        <!-- PUBLIC KEY -->
        <label for="id_public_key">Public Key</label>
        <div class="field {% if form.public_key.errors %}invalid{% endif %}">
          <input
            id="id_public_key"
            type="text"
            name="public_key"
            value="{{ form.public_key.value|default_if_none:'' }}"
            placeholder="TEST-xxxxxxxxxxxxxxxxxxxx"
            required
            autocomplete="off"
          />
          <button class="btn-ghost" type="button" data-copy="id_public_key">Copiar</button>
        </div>
        {% if form.public_key.errors %}
          <ul class="errorlist">
            {% for error in form.public_key.errors %}<li>{{ error }}</li>{% endfor %}
          </ul>
        {% else %}
          <div class="hint">Informe a Public Key do Mercado Pago.</div>
        {% endif %}

        <!-- SANDBOX -->
        <div>
          <label class="switch" for="id_sandbox_mode">
            <input id="id_sandbox_mode" type="checkbox" name="sandbox_mode" {% if form.sandbox_mode.value %}checked{% endif %} />
            <span class="toggle" aria-hidden="true"></span>
            <span style="font-weight:500">Modo Sandbox (teste)</span>
          </label>
          <div class="hint">Ative para testar pagamentos sem cobran√ßa real.</div>
        </div>

        <button class="btn" type="submit">Salvar configura√ß√£o</button>
      </form>
    </div>
  </div>

  <script>
    // Mostrar/ocultar senha (Access Token)
    document.querySelectorAll('[data-eye]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-eye');
        const input = document.getElementById(id);
        if(!input) return;
        const isPwd = input.type === 'password';
        input.type = isPwd ? 'text' : 'password';
        btn.textContent = isPwd ? 'üôà' : 'üëÅÔ∏è';
      });
    });

    // Copiar valor do input
    document.querySelectorAll('[data-copy]').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const id = btn.getAttribute('data-copy');
        const input = document.getElementById(id);
        if(!input) return;
        try{
          await navigator.clipboard.writeText(input.value || '');
          const old = btn.textContent;
          btn.textContent = '‚úÖ Copiado';
          setTimeout(()=> btn.textContent = old, 1600);
        }catch(e){
          const old = btn.textContent;
          btn.textContent = '‚ö†Ô∏è Falhou';
          setTimeout(()=> btn.textContent = old, 1600);
        }
      });
    });

    // Evita duplo envio
    (function(){
      const form = document.querySelector('form');
      if(!form) return;
      form.addEventListener('submit', ()=>{
        const submit = form.querySelector('button[type="submit"]');
        if(submit) submit.setAttribute('disabled','disabled');
      });
    })();
  </script>
</body>
</html>
