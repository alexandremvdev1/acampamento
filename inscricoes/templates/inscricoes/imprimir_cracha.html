{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Crachá — {{ inscricao.evento.nome }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    /* ===== IMPRESSÃO ===== */
    @page { size: A4 portrait; margin: 10mm; }
    @media print{
      *{ -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      html, body { margin:0; background:#fff; width:210mm; height:297mm; }
      .no-print, .navbar { display:none !important; }

      .print-stage{
        position:relative; width:190mm; height:277mm;
        margin:0 auto; display:grid; place-items:center;
      }
      .cracha-wrapper{
        width: 90mm; height: 130mm;
        position: relative; box-sizing: border-box;
        overflow: visible; border:0; border-radius:0; background:#fff;
        page-break-inside: avoid; break-inside: avoid-page;
      }
      /* marcas de corte fora do crachá */
      .cracha-wrapper::before{
        content:""; position:absolute; inset:-3mm; pointer-events:none; opacity:.95;
        background-repeat:no-repeat;
        background-image:
          linear-gradient(#000,#000), linear-gradient(#000,#000),
          linear-gradient(#000,#000), linear-gradient(#000,#000),
          linear-gradient(#000,#000), linear-gradient(#000,#000),
          linear-gradient(#000,#000), linear-gradient(#000,#000);
        background-size:
          4mm .3mm, .3mm 4mm,
          4mm .3mm, .3mm 4mm,
          4mm .3mm, .3mm 4mm,
          4mm .3mm, .3mm 4mm;
        background-position:
          left 3mm  top 0,      left 0    top 3mm,
          right 3mm top 0,      right 0   top 3mm,
          left 3mm  bottom 0,   left 0    bottom 3mm,
          right 3mm bottom 0,   right 0   bottom 3mm;
      }

      .screen-stage{ display:none !important; }
    }

    /* ===== TELA (preview) ===== */
    :root{
      --ink:#0f172a; --muted:#64748b; --line:#e5e7eb; --panel:#fff;
      --shadow:0 10px 24px rgba(17,24,39,.08);
    }
    html{ font-size:14px; }
    body{ background:#f6f8fb; color:var(--ink); overflow-x:hidden; }
    .nav-pro{ background:linear-gradient(90deg,#0b1020,#111a3a); }

    .screen-stage{
      min-height: calc(100vh - 56px);
      display:grid; place-items:center; padding:24px;
    }
    .cracha-wrapper{
      width: 360px; height: 520px; /* preview proporcional */
      border:1px dashed #cbd5e1; border-radius:12px;
      background:#fff; position:relative; box-sizing:border-box; overflow:hidden;
      box-shadow:var(--shadow);
    }

    /* Estilos usados pelo parcial _cracha_inside.html */
    .cracha{
      position:absolute; inset:0; border-radius:12px; overflow:hidden; display:flex; flex-direction:column;
      background:
        radial-gradient(120% 80% at 50% -20%, rgba(255,255,255,.15), transparent 50%),
        linear-gradient(180deg,
          color-mix(in srgb, var(--grp) 90%, #ffffff 10%) 0%,
          color-mix(in srgb, var(--grp) 60%, #000000 40%) 100%);
      border:1px solid color-mix(in srgb, var(--grp) 50%, #0000 50%);
    }
    .ribbon{
      position:absolute; top:10px; right:-38px; z-index:5;
      background:linear-gradient(135deg, #f59e0b, #d97706);
      color:#fff; font-weight:900; font-size:.72rem; letter-spacing:.08em;
      padding:6px 44px; transform:rotate(35deg);
      text-shadow:0 1px 1px rgba(0,0,0,.25);
      box-shadow:0 4px 12px rgba(0,0,0,.25);
      border:1px solid rgba(0,0,0,.15);
    }
    .topo{
      height:120px; position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden;
      background: linear-gradient(135deg, rgba(0,0,0,.15), rgba(0,0,0,.35));
    }
    .topo img{
      position:absolute; inset:0; width:100%; height:100%; object-fit:cover; z-index:0;
      filter:brightness(0.95) saturate(1.05);
    }
    .topo::after{
      content:""; position:absolute; inset:0; z-index:1;
      background: linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.28));
    }
    .miolo{
      padding:54px 12px 0; display:flex; flex-direction:column; align-items:center; text-align:center; gap:8px; flex:1;
    }
    .avatar{
      width:110px; height:110px; border-radius:50%; object-fit:cover; border:3px solid #fff;
      box-shadow:0 8px 24px rgba(2,6,23,.24); margin-top:-40px; background:#e5e7eb;
    }
    .nome{
      margin:2px 0 0; font-size:1.06rem; font-weight:900; line-height:1.2; color:#fff;
      text-shadow: 0 1px 2px rgba(0,0,0,.35); word-break:break-word; max-width:92%;
    }
    .linha-info{ display:flex; flex-direction:column; align-items:center; gap:6px; margin-top:6px; }
    .gline{ display:inline-flex; align-items:center; gap:8px; font-weight:900; color:#fff; text-shadow:0 1px 2px rgba(0,0,0,.35); }
    .gdot{ width:10px; height:10px; border-radius:50%; display:inline-block; border:1px solid rgba(255,255,255,.6); }
    .tag{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; font-weight:900; color:#0b1220;
      background: linear-gradient(135deg, rgba(255,255,255,.95), rgba(255,255,255,.88));
      border:1px solid rgba(255,255,255,.9);
      box-shadow: 0 2px 10px rgba(2,6,23,.18), inset 0 0 0 1px rgba(15,23,42,.05);
    }
    .tag .coord{
      padding:2px 8px; border-radius:999px; font-size:.72rem; font-weight:900; color:#fff;
      background:linear-gradient(135deg, #ef4444, #b91c1c); border:1px solid rgba(255,255,255,.6);
    }
    .cidade{ margin-top:2px; font-size:.86rem; font-weight:700; color:#e5e7eb; text-shadow:0 1px 1px rgba(0,0,0,.3); }
    .rodape{ padding:12px 12px 14px; display:flex; justify-content:center; align-items:center; }
    .qr-wrap{
      background:#fff; border:1px solid #e2e8f0; border-radius:12px; padding:8px;
      box-shadow: 0 4px 16px rgba(2,6,23,.12), inset 0 0 0 1px #f1f5f9;
    }
    .qr{ width:88px; height:88px; display:block; }
  </style>
</head>
<body>

<nav class="navbar nav-pro navbar-dark no-print">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="{% url 'inscricoes:relatorios_evento' inscricao.evento.id %}">← Relatórios</a>
    <div class="ms-auto d-flex align-items-center gap-2">
      <span class="navbar-text small d-none d-md-inline text-white-50">{{ inscricao.evento.nome }}</span>
      <button class="btn btn-light btn-sm" onclick="window.print()">Imprimir</button>
    </div>
  </div>
</nav>

<!-- Preview na tela -->
<div class="screen-stage">
  <div class="cracha-wrapper">
    {# Passa explicitamente par e couple_mode para o parcial (evita qualquer ambiguidade) #}
    {% include "inscricoes/_cracha_inside.html" with inscricao=inscricao par=par couple_mode=couple_mode only %}
  </div>
</div>

<!-- Área de impressão (1 crachá central) -->
<div class="print-stage">
  <div class="cracha-wrapper">
    {% include "inscricoes/_cracha_inside.html" with inscricao=inscricao par=par couple_mode=couple_mode only %}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
