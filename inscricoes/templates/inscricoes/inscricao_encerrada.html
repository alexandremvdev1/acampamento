{# templates/inscricoes/inscricao_encerrada.html #}
{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    {% now "U" as now_ts %}
    {% if evento.inicio_inscricoes|date:"U" > now_ts %}
      Inscri√ß√µes n√£o iniciadas ‚Ä¢ {{ evento.nome }}
    {% else %}
      Inscri√ß√µes Encerradas ‚Ä¢ {{ evento.nome }}
    {% endif %}
  </title>
  <style>
    :root{
      --bg:#0b1020; --card:#11162a; --text:#f4f6fb; --muted:#c1c7d3; --line:rgba(255,255,255,.10);
      --shadow:0 18px 40px rgba(0,0,0,.35); --brand:#4f7cff; --accent:#22c55e;
      --chip-bg:rgba(79,124,255,.12); --chip-br:#4f7cff33;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f3f5f9; --card:#ffffff; --text:#0e1320; --muted:#5b6473; --line:#e9edf5; --shadow:0 12px 30px rgba(10,36,99,.10);
        --chip-bg:#eef2ff; --chip-br:#dbe4ff;
      }
    }

    /* Reset b√°sico e prote√ß√£o contra scroll lateral */
    *{ box-sizing:border-box; max-width:100%; }
    html,body{
      margin:0;
      background:
        radial-gradient(1200px 1200px at -10% -10%, rgba(79,124,255,.18), transparent 40%),
        radial-gradient(1200px 1200px at 110% 10%, rgba(34,197,94,.14), transparent 40%),
        var(--bg);
      color:var(--text);
      font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;
      min-height:100dvh;
      overflow-x:hidden;              /* <- impede rolagem lateral */
      -webkit-text-size-adjust:100%;
      word-break:break-word;          /* <- previne estouro de textos longos */
    }
    img,svg,video,canvas{ display:block; max-width:100%; height:auto; }

    .wrap{
      min-height:100dvh;
      display:grid;
      place-items:center;
      padding:24px 12px;
    }

    .card{
      width:100%;
      max-width:720px;                /* <- limita a largura e centraliza */
      background:var(--card);
      border-radius:20px;
      box-shadow:var(--shadow);
      outline:1px solid var(--line);
      overflow:hidden;
      margin:0 auto;
    }

    .head{
      padding:16px 16px 0;
      text-align:center;
    }
    .logo{
      height:48px; width:auto; margin:0 auto 8px; object-fit:contain;
      filter: drop-shadow(0 4px 14px rgba(0,0,0,.18));
    }
    .banner{
      width:100%; max-height:220px; object-fit:cover; border-bottom:1px solid var(--line);
      margin:0 auto;
    }
    .img-insc{
      width:100%; max-height:220px; object-fit:cover; border-bottom:1px dashed var(--line);
      margin:0 auto;
    }

    .body{
      padding:16px;
      text-align:center;              /* <- centraliza todo o conte√∫do do corpo */
    }
    .emoji{ font-size:50px; line-height:1; margin:4px 0 8px; }
    h1{ margin:0 0 8px; font-size:clamp(18px, 5vw, 26px); letter-spacing:.2px; }
    p{ margin:8px 0; color:var(--muted) }

    .pill{
      display:inline-block; margin:8px 0 10px; padding:8px 14px; border-radius:999px;
      background:var(--chip-bg); color:var(--text); font-weight:800; font-size:.95rem; outline:1px solid var(--chip-br);
    }

    /* ===== Datas destacadas (agora centralizadas e flu√≠das) ===== */
    .details{
      margin-top:12px;
      display:grid; gap:10px;
      grid-template-columns:1fr 1fr;
      justify-items:center;           /* <- centraliza cada item no grid */
      align-items:stretch;
      text-align:center;              /* <- centraliza textos dentro dos itens */
    }
    @media (max-width:560px){ .details{ grid-template-columns:1fr } }

    .item{
      width:100%;
      border-radius:14px; padding:12px;
      outline:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0));
    }
    @media (prefers-color-scheme: light){ .item{ background:#f6f8fc; } }

    .item .label{
      display:flex; justify-content:center; align-items:center; gap:8px;
      font-size:.9rem; color:var(--muted); margin-bottom:6px; letter-spacing:.2px;
    }
    .item .label .dot{ width:10px; height:10px; border-radius:50%; background:var(--brand); opacity:.8 }

    .item .date{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:10px 14px; border-radius:12px; font-weight:900;
      outline:1px solid var(--chip-br);
      background:linear-gradient(135deg, rgba(79,124,255,.18), rgba(79,124,255,.06));
      font-size:clamp(18px, 6vw, 28px);
      letter-spacing:.5px;
      width:100%;
      max-width:360px;                /* <- impede larguras estranhas */
      margin:0 auto;
    }

    /* ===== Countdown (centralizado e sem overflow) ===== */
    .countwrap{ margin-top:12px; display:flex; flex-direction:column; align-items:center; gap:8px; }
    .countwrap .legend{ font-size:.9rem; color:var(--muted); text-align:center; }

    .countdown{
      display:flex; gap:10px; padding:10px; border-radius:14px;
      outline:1px solid var(--chip-br);
      background:linear-gradient(135deg, rgba(34,197,94,.14), rgba(34,197,94,.06));
      font-weight:800; flex-wrap:wrap; justify-content:center;
      width:100%;
      max-width:520px;                /* <- largura m√°xima controlada */
      margin:0 auto;
    }
    .cd-box{
      min-width:64px; border-radius:12px; padding:10px 12px; text-align:center;
      background:rgba(255,255,255,.06); outline:1px solid var(--line);
      flex:1 0 64px; max-width:110px;
    }
    @media (prefers-color-scheme: light){ .cd-box{ background:#fff; } }
    .cd-box .num{ display:block; font-size:clamp(20px, 8vw, 32px); line-height:1; }
    .cd-box .lbl{ display:block; margin-top:4px; font-size:.8rem; color:var(--muted); letter-spacing:.2px }

    .actions{
      margin-top:14px;
      display:grid; gap:10px; grid-template-columns:1fr;
      justify-items:center;           /* <- centraliza bot√£o */
    }
    .btn{
      appearance:none; border:0; cursor:pointer; text-decoration:none;
      display:inline-block; padding:12px 14px; border-radius:12px; font-weight:800; text-align:center;
      background:linear-gradient(135deg, #25D366, #1ebc59); color:#fff; outline:none;
      width:100%; max-width:360px;    /* <- largura do bot√£o controlada e centralizada */
    }

    .foot{
      padding:12px 14px;
      text-align:center; color:var(--muted); font-size:.9rem;
      border-top:1px solid var(--line);
    }

    /* Afinando em telas bem pequenas */
    @media (max-width:380px){
      .logo{ height:42px }
      .banner,.img-insc{ max-height:170px }
      .emoji{ font-size:44px }
      .item .date{ padding:8px 12px }
    }
  </style>
</head>
<body>
  {% now "U" as now_ts %}
  {% with inicio_ts=evento.inicio_inscricoes|date:"U" fim_ts=evento.fim_inscricoes|date:"U" %}
  <div class="wrap">
    <div class="card" role="region" aria-label="Status das inscri√ß√µes do evento">
      <div class="head">
        {% if politica and politica.logo %}
          <img class="logo" src="{{ politica.logo.url }}" alt="Logo da organiza√ß√£o" loading="lazy" />
        {% endif %}
        {% if evento.banner %}
          <img class="banner" src="{{ evento.banner.url }}" alt="Banner do evento {{ evento.nome }}" loading="lazy">
        {% endif %}
      </div>

      <div class="body">
        {% if inicio_ts > now_ts %}
          <div class="emoji" aria-hidden="true"></div>
          <span class="pill" aria-live="polite">Inscri√ß√µes n√£o iniciadas</span>
          <h1>{{ evento.nome }}</h1>

          <div class="details" aria-label="Informa√ß√µes do evento">
            <div class="item">
              <div class="label"><span class="dot" aria-hidden="true"></span> In√≠cio das Inscri√ß√µes</div>
              <div class="date" aria-label="In√≠cio das inscri√ß√µes">
                {{ evento.inicio_inscricoes|date:"d/m/Y" }}
              </div>
            </div>
            <div class="item">
              <div class="label"><span class="dot" aria-hidden="true" style="background:var(--accent)"></span> In√≠cio do Evento</div>
              <div class="date" aria-label="In√≠cio do evento">
                {{ evento.data_inicio|date:"d/m/Y" }}
              </div>
            </div>
          </div>

          <div class="countwrap" aria-live="polite">
            <div class="legend">Tempo restante para abrir inscri√ß√µes</div>
            <div id="countdown" class="countdown" hidden>
              <div class="cd-box"><span id="cd-d" class="num">0</span><span class="lbl">dias</span></div>
              <div class="cd-box"><span id="cd-h" class="num">0</span><span class="lbl">horas</span></div>
              <div class="cd-box"><span id="cd-m" class="num">0</span><span class="lbl">min</span></div>
              <div class="cd-box"><span id="cd-s" class="num">0</span><span class="lbl">seg</span></div>
            </div>
          </div>

          <p>As inscri√ß√µes ainda n√£o come√ßaram. Volte a partir da data indicada acima.</p>
        {% else %}
          <div class="emoji" aria-hidden="true">üö´</div>
          <span class="pill">Inscri√ß√µes Encerradas</span>
          <h1>{{ evento.nome }}</h1>

          <div class="details" aria-label="Informa√ß√µes do evento">
            <div class="item">
              <div class="label"><span class="dot" aria-hidden="true"></span> Encerramento das Inscri√ß√µes</div>
              <div class="date" aria-label="Encerramento das inscri√ß√µes">
                {{ evento.fim_inscricoes|date:"d/m/Y" }}
              </div>
            </div>
            <div class="item">
              <div class="label"><span class="dot" aria-hidden="true" style="background:var(--accent)"></span> In√≠cio do Evento</div>
              <div class="date" aria-label="In√≠cio do evento">
                {{ evento.data_inicio|date:"d/m/Y" }}
              </div>
            </div>
          </div>

          <p>As inscri√ß√µes para este evento n√£o est√£o mais dispon√≠veis.</p>
          <p>Fique de olho nos pr√≥ximos encontros e atividades!</p>
        {% endif %}

        <div class="actions">
          {% if evento.paroquia.telefone %}
            <a class="btn" href="https://wa.me/{{ evento.paroquia.telefone|slice:'3:' }}" target="_blank" rel="noopener">
              Falar com a organiza√ß√£o
            </a>
          {% endif %}
        </div>
      </div>

      <div class="foot">
        {{ evento.paroquia.nome }} ‚Ä¢ {{ evento.paroquia.cidade }} ‚Äî {{ evento.paroquia.estado }}
      </div>
    </div>
  </div>
  {% endwith %}

  {% if evento.inicio_inscricoes|date:"U" > now_ts %}
  <script>
    (function(){
      const target = new Date("{{ evento.inicio_inscricoes|date:'Y-m-d' }}T00:00:00").getTime();
      const box = document.getElementById('countdown');
      if(!box) return;
      box.hidden = false;
      const $ = id => document.getElementById(id);
      const t = setInterval(() => {
        const now = Date.now();
        const dist = target - now;
        if (dist <= 0){
          clearInterval(t);
          box.outerHTML = '<div class="pill" role="status">Inscri√ß√µes liberadas</div>';
          return;
        }
        const days = Math.floor(dist / (1000*60*60*24));
        const hours = Math.floor((dist % (1000*60*60*24)) / (1000*60*60));
        const mins = Math.floor((dist % (1000*60*60)) / (1000*60));
        const secs = Math.floor((dist % (1000*60)) / 1000);
        $('cd-d').textContent = days;
        $('cd-h').textContent = hours;
        $('cd-m').textContent = mins;
        $('cd-s').textContent = secs;
      }, 1000);
    })();
  </script>
  {% endif %}
</body>
</html>
